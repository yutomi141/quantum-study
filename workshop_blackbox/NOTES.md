# 技術学習ログ: 量子アニーリングによるMax-Cut問題の実装

**Date:** 2025-11-20
**Topic:** Quantum Annealing, Ising Model, Fixstars Amplify, Python Engineering

## 1. アーキテクチャと技術スタック

### 環境分離とセキュリティ
* **`.env` / `python-dotenv`**:
    * APIトークンなどの機密情報はコードに直書きせず、環境変数として管理する。
    * `load_dotenv()`: 引数なしで実行すると、カレントディレクトリの `.env` を自動的に読み込む。
    * `os.getenv("KEY")`: OSの環境変数から値を取得する。存在しない場合の `None` ハンドリングが必須。
* **`.venv` (Virtual Environment)**:
    * プロジェクトごとに依存ライブラリを隔離し、バージョンの競合を防ぐ。

### グラフ理論と乱数 (NetworkX / NumPy)
* **`nx.gnp_random_graph(n, p)`**:
    * エルデシュ・レーニ・モデル（$G_{np}$）に基づくランダムグラフ生成関数。
* **`seed` (シード値) の重要性**:
    * `np.random.seed(seed)` や関数の引数 `seed` は、乱数生成のパターンを固定するために使用する。
    * **目的**: 科学実験としての「再現性（Reproducibility）」を担保するため。同じシードなら常に同じグラフ、同じ重みが生成される。
* **辞書型アクセス**:
    * `G.edges[u, v]["weight"]` のように、エッジごとの属性（重みなど）は辞書形式で格納されている。

## 2. 物理モデルの実装 (Ising Hamiltonian)

### 変数のライフサイクル
1.  **定義フェーズ (`VariableGenerator`)**:
    * `gen.array("Ising", N)` で作成される `s` は、まだ数値ではない。数式を構築するための**「記号（シンボル）オブジェクト」**。
2.  **構築フェーズ (Hamiltonian)**:
    * ループ内で `s[u] * s[v]` などを計算しても、それは「数式の定義」を行っているだけで、計算は実行されない。
3.  **解決フェーズ (`solve`)**:
    * クライアントを通じて数式が送信され、マシンが最適解を探索する。
4.  **実体化フェーズ (`evaluate`)**:
    * `spins.evaluate(result.best.values)` を実行して初めて、記号 `s` に具体的な数値（+1, -1）が代入される。

### ハミルトニアンの定式化ロジック
Max-Cut問題をイジングマシン（Amplify）で解くための翻訳プロセス。

* **目的**: カットされる辺の重み合計 $C$ を **最大化** したい。
* **制約**: Amplifyはエネルギー $H$ を **最小化** するソルバーである。
* **定式化**:
    * スピンが異符号（カット成功）のとき: $s_u s_v = -1 \Rightarrow (1 - s_u s_v)/2 = 1$
    * スピンが同符号（カット失敗）のとき: $s_u s_v = +1 \Rightarrow (1 - s_u s_v)/2 = 0$
    * **結論**: $H = -C = - \sum w_{ij} \frac{1 - s_i s_j}{2}$ と定義する。

## 3. Fixstars Amplify SDK の仕様
* **`FixstarsClient`**:
    * トークンを設定しないと認証エラーになる。
    * `timeout` 設定により、解が見つからない場合の無限待機を防ぐ。
* **`solve(hamiltonian, client)`**:
    * 「何を（数式）」と「どこで（マシン）」を分離した設計になっている。
* **`result` オブジェクト**:
    * 解が見つからない場合はリスト長が0になるため、`len(result) > 0` のチェックが必要。
    * `result.best.objective` は最小化されたエネルギー値（マイナス）が返るため、利用時は符号反転して解釈する。

## 4. Pythonエンジニアリングの作法
* **Type Hinting**: `def func(n: int)` のように型を明示し、可読性と保守性を高める。
* **f-string**: `f"Value: {val}"` を使用し、変数の埋め込みや `{}` 内での演算を行う。
* **Main Guard**: `if __name__ == "__main__":` ブロックを使用し、モジュールとしてインポートされた際に勝手に実行されないようにする。
